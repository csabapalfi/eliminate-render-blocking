<!doctype html><html lang="en"><head><meta charset="utf-8"><title>&#x26A1; How to eliminate render-blocking JavaScript and CSS</title><meta name="viewport" content="width=device-width,initial-scale=1"></head><body><style>.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body a{background-color:transparent}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body *{box-sizing:border-box}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body h1,.markdown-body h2,.markdown-body h3{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px;font-weight:600}.markdown-body h2{font-size:24px;font-weight:600}.markdown-body h3{font-size:20px;font-weight:600}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body blockquote,.markdown-body p,.markdown-body pre,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body ul{padding-left:2em}.markdown-body li{word-wrap:break-all}.markdown-body li+li{margin-top:.25em}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-tag .hljs-attr{color:teal}.hljs-string{color:#d14}.hljs-name,.hljs-tag{color:navy;font-weight:400}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}@media screen and (max-width:480px){.markdown-body{padding:15px}}.markdown-body .heading-anchor{color:inherit}</style><article class="markdown-body"><h1>&#x26A1; How to eliminate render-blocking JavaScript and CSS</h1><p><a href="https://csabapalfi.github.io">Csaba Palfi</a>, Dec 2016</p><p>Most web performance recommendations are simple to put into practice. Minifying assets or optimizing images is a matter of configuring some basic tooling.</p><p>Other optimizations assume you have more knowledge of browser internals but can really pay off in terms of user experience. (Especially for mobile users on a slow connection.)</p><p>This post is about eliminating render blocking resources and prioritizing above-the-fold content. These practices enable <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/">optimized (progressive) rendering</a> of your web pages.</p><h2><a class="heading-anchor" name="do-you-have-the-problem-" href="#do-you-have-the-problem-">Do you have the problem?</a></h2><h3><a class="heading-anchor" name="pagespeed-insights" href="#pagespeed-insights">PageSpeed Insights</a></h3><p>Do you fail the <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a> rule below?</p><blockquote><p><strong>Eliminate render-blocking JavaScript and CSS in above-the-fold content</strong></p></blockquote><p>Hint: use <a href="https://ngrok.com/">ngrok</a> to run PageSpeed Insights against localhost or a private network.</p><h3><a class="heading-anchor" name="webpagetest-org" href="#webpagetest-org">WebPageTest.org</a></h3><p>Is your <a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/metrics/speed-index">Speed index</a>, <a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/quick-start-quide#TOC-Start-Render:">Start Render </a>and Visually Complete times too high? Ideally your Visually Complete time should be less than a second.</p><p>(See the Details tab on the results page for the Visually Complete time.)</p><h3><a class="heading-anchor" name="chrome-developer-tools" href="#chrome-developer-tools">Chrome Developer Tools</a></h3><p>Enable throttling (e.g 2G or 3G) in the Network tab then go to your page. Are you staring at a blank screen for seconds? (Be sure to start from <code>about:blank</code> to really see how long it takes for rendering to start).</p><p>You can also look at the screenshots/filmstrip in the <a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/timeline-tool">Timeline tab</a>.</p><h2><a class="heading-anchor" name="how-css-resources-can-block-rendering-" href="#how-css-resources-can-block-rendering-">How CSS resources can block rendering?</a></h2><p>It&apos;s important to understand the critical steps that need to happen before a single pixel can be painted on the screen. The browser:</p><ul><li>parses your <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model">HTML into the DOM tree and your CSS into a CSSOM tree</a></li><li>these are <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction">combined into a render tree</a> that only contains the visible DOM content</li><li>the layout and paint steps depend on the render tree which depends on the CSSOM - <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-blocking-css">nothing can be put on the screen before that&apos;s ready</a></li></ul><p>When the browser encounters a link tag for a stylesheet it&apos;ll have to go and fetch it as it&apos;s needed for building the render tree. Sometimes that CSS file is your bundle containing the styles for your whole page (maybe even the whole website).</p><p>Your users could be waiting for the styles for something that&apos;s not even on the screen! (i.e. below the fold). For someone on a slow connection that can mean seeing a blank screen for seconds.</p><p>Side-note: The main reason why the browser block rendering until it has the styles is to avoid <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content">FUOC</a>.</p><h2><a class="heading-anchor" name="how-to-fix-render-blocking-css-" href="#how-to-fix-render-blocking-css-">How to fix render blocking CSS?</a></h2><h3><a class="heading-anchor" name="inline-critical-styles" href="#inline-critical-styles">Inline critical styles</a></h3><p>Critical-path styles are the styles that are required to render correctly everything that&apos;s <strong>above the fold</strong>.</p><p>You should inline these styles to avoid additional HTTP requests blocking initial rendering. You&apos;ll find that there&apos;s a <a href="https://github.com/addyosmani/critical-path-css-tools">collection of tools to help with this</a>.</p><pre class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>critical CSS rules here<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</pre><p>Some additional tips:</p><ul><li>You should consider figuring out what above-the-fold means for your users based on web analytics.</li><li>Also make sure you don&apos;t use <code>@import</code> statements in critical CSS as that&apos;ll also trigger additional HTTP requests.</li><li>Be sure not to inline too much CSS as that&apos;ll also slow down your initial render.</li><li>Read some more explanation/tips from <a href="https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery">Google</a> and <a href="https://varvy.com/pagespeed/optimize-css-delivery.html">Varvy</a>.</li></ul><h3><a class="heading-anchor" name="load-non-critical-css-asynchronously" href="#load-non-critical-css-asynchronously">Load non-critical CSS asynchronously</a></h3><p>Inlining your critical CSS is not enough as the browser will still block rendering as soon as it encounters your non-critical CSS referenced using a <code>link</code> tag.</p><p>Luckily there&apos;s a new browser feature called <a href="https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/">Preload (aka <code>rel=preload</code>)</a> that allows us to start fetching our CSS but prevent it from blocking. At the moment it&apos;s <a href="http://caniuse.com/#search=preload">only supported on Chrome</a> but it can be <a href="https://github.com/filamentgroup/loadCSS">polyfilled on other browsers</a>.</p><p>See recommended usage in the <a href="https://github.com/filamentgroup/loadCSS#recommended-usage-pattern">polyfill docs</a>. Your code for this will look something like this:</p><pre class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/non-critical.css&quot;</span> <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;style&quot;</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;this.rel=&apos;stylesheet&apos;&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>inlcude loadCSS polyfill here<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</pre><p>Tip: The linked polyfill is not in any module format but with Webpack you can just use the script-loader to make sure it runs properly.</p><h2><a class="heading-anchor" name="how-about-render-blocking-javascript-" href="#how-about-render-blocking-javascript-">How about render-blocking JavaScript?</a></h2><p>JavaScript can <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/adding-interactivity-with-javascript">also block rendering</a>. When the browser sees a <code>script</code> tag it&apos;ll need to pause building the DOM tree and execute the script. That&apos;s one of the reasons why it&apos;s generally recommended to have script tags at the bottom of you page. Fortunately it&apos;s also much easier to make JavaScript loading asynchronous since the script tag has the <code>async</code> attribute.</p><p>You might also want to inline some (small amount of!) JavaScript that&apos;s critical for above the fold content (and of course the loadCSS polyfill if you&apos;re using <code>rel=preload</code> for styles)</p><p><img src="https://ga-beacon.appspot.com/UA-29212656-1/eliminate-render-blocking?pixel" alt></p></article></body></html>